types
  enum Error {High, Low, Erratic, Halted, Early, Late}

components
  AppLogic
    ports
      in RespRate
      in EtCO2
      in PulseRate
      in SpO2
      out CommandPump
//--------------------------------------------------------------------------------//

  PcaPump
    ports
      in AppCommand
      out Drug
    behaviour
      {AppCommand.Error:High, AppCommand.Error:Erratic, AppCommand.Error:Early,
                       AppCommand.Error:Late} -> Drug.Error:High

      AppCommand.Error:Low -> {Drug.Error:Late, Drug.Error:Low}
      //When command is not well formed, pump action is not taken

      AppCommand.Error:Halted -> {Drug.Error:Halted}

    property
      AppCommand : Set[Error] = {High, Erratic, Early, Late}
      Drug : Set[Error] = {High, Low, Halted}
//--------------------------------------------------------------------------------//

  Patient
    ports
      in Dosage
      out HbO2
      out ExhaleAir
   behaviour
      {Dosage.Error:High, Dosage.Error:Early} -> (HbO2.Error:Low, {ExhaleAir.Error:Low, ExhaleAir.Error:Erratic})
      {Dosage.Error:Low, Dosage.Error:Late} -> ExhaleAir.Error:Erratic
      {Dosage.Error:Halted, Dosage.Error:Erratic} -> ({HbO2.Erratic, HbO2.Low}, ExhaleAir.Erratic)

   property
      Dosage : Set[Error] = {High, Low, Halted, Erratic, Early, Late}
      HbO2 : Set[Error] = {Low, Erratic}
      ExhaledAir : Set[Error] = {Erratic, Low}
//--------------------------------------------------------------------------------//

  PulseOx
    ports
      in Pulse
      out SpO2
      out PulseRate
    behaviour
      Pulse.Error:Low -> (SpO2.Error:Low, PulseRate.Error:Low)
      {Pulse.Error:Halted, Pulse.Error:Erratic}-> (SpO2.Error:Low, {PulseRate.Error:Halted, PulseRate.Error:Erratic})
      {Pulse.Error:High, Pulse.Error:Early} -> PulseRate.Error:High
      Pulse.Error:Late -> (SpO2.Error:Low, PulseRate.Error:Low)

    property
      Pulse : Set[Error] = {Low, High, Halted, Erratic, Late, Early}
      SpO2 : Set[Error] = {Low}
      PulseRate : Set[]Error = {Low, Halted, Erratic, High, Late}
//--------------------------------------------------------------------------------//
  Capnograph
    ports
      in ExhaledCO2
      out EtCO2
      out RespRate
    behaviour
      ExhaledCO2.Error:High -> (EtCO2.Error:High, RespRate.Error:High)
      {ExhaledCO2.Error:Halted, ExhaledCO2.Error:Erratic} ->
                                (EtCO2.Error:Low, {RespRate.Error:Halted, RespRate.Error:Erratic})
      {ExhaledCO2.Error:High, ExhaledCO2.Error:Early} -> (EtCO2.Error:High, RespRate.Error:High)
      ExhaledCO2.Error:Late -> (EtCO2.Error:Low, RespRate.Error:Low)
    Property


Connections
  App_to_Pump: AppLogic.CommandPump -> PcaPump.AppCommand
  behaviour


  IVLine: PcaPump.Drug -> Patient.Dosage

  RefractedLight: Patient.HbO2 -> PulseOx.Pulse

  Breath: Patient.ExhaleAir -> Capnograph.ExhaledCO2

  SpO2_to_App: PulseOx.SpO2 -> AppLogic.SpO2

  PulseRate_to_App: PulseOx.PulseRate -> AppLogig.PulseRate

  EtCO2_to_App: Capnograph.EtCO2 -> AppLogic.EtCO2

  RespRate_to_App: Capnograph.RespRate -> AppLogic.RespRate